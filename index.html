<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>QR Code Generator</title>
  <meta name="description" content="A fast, single‑file QR code generator designed for GitHub Pages. Create, style, and download QR codes as PNG or SVG with shareable links." />
  <meta name="theme-color" content="#0ea5e9" />

  <style>
    :root {
      --bg: #0b1220;
      --panel: #0f172a;
      --muted: #94a3b8;
      --text: #e2e8f0;
      --accent: #22d3ee;
      --ring: rgba(34, 211, 238, 0.4);
      --shadow: 0 10px 30px rgba(2, 6, 23, 0.6);
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell,
      Noto Sans, "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji";
      background: radial-gradient(1000px 700px at 10% -10%, #0ea5e9 0%, transparent 60%),
                  radial-gradient(800px 600px at 110% 10%, #22d3ee 0%, transparent 55%),
                  var(--bg);
      color: var(--text);
      -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale;
    }
    a { color: var(--accent); text-decoration: none; }
    a:hover { text-decoration: underline; }

    .wrap { max-width: 1100px; margin: 0 auto; padding: 24px; }
    header { display: flex; align-items: center; justify-content: space-between; gap: 16px; flex-wrap: wrap; }
    .brand { display: flex; align-items: center; gap: 12px; }
    .logo { width: 36px; height: 36px; border-radius: 10px; background: linear-gradient(135deg, #22d3ee, #0ea5e9); box-shadow: var(--shadow); }
    h1 { font-size: clamp(20px, 3vw, 28px); margin: 0; letter-spacing: .25px; }

    .card {
      background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
      border: 1px solid rgba(148, 163, 184, 0.2);
      border-radius: 16px; box-shadow: var(--shadow);
      padding: 18px;
    }

    .layout { display: grid; grid-template-columns: 1.2fr 1fr; gap: 18px; margin-top: 18px; }
    @media (max-width: 960px) { .layout { grid-template-columns: 1fr; } }

    .controls { display: grid; gap: 14px; }
    .field { display: grid; gap: 8px; }
    .field.inline { grid-template-columns: 1fr auto; align-items: center; gap: 12px; }
    label { color: var(--muted); font-size: 12px; text-transform: uppercase; letter-spacing: .12em; }
    input[type="text"], input[type="url"], input[type="number"], textarea, select {
      width: 100%; background: var(--panel); color: var(--text); border: 1px solid rgba(148,163,184,.25);
      border-radius: 12px; padding: 12px 14px; outline: none; transition: box-shadow .15s, border-color .15s;
    }
    textarea { resize: vertical; min-height: 72px; }
    input:focus, textarea:focus, select:focus { border-color: var(--accent); box-shadow: 0 0 0 4px var(--ring); }

    .row { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; }
    @media (max-width: 720px) { .row { grid-template-columns: repeat(2, 1fr); } }

    .actions { display: flex; flex-wrap: wrap; gap: 10px; }
    button {
      appearance: none; border: 1px solid rgba(148,163,184,.25); background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      color: var(--text); padding: 10px 14px; border-radius: 12px; cursor: pointer; transition: transform .06s ease, border-color .15s;
    }
    button:hover { border-color: var(--accent); }
    button:active { transform: translateY(1px); }
    .primary { background: linear-gradient(135deg, #22d3ee, #0ea5e9); border: none; color: #06121f; font-weight: 700; }

    /* Preview card */
    .preview { display: grid; gap: 12px; place-items: center; text-align: center; }
    .canvas-wrap {
      width: 100%; aspect-ratio: 1/1; background: var(--panel); border: 1px dashed rgba(148,163,184,.35);
      border-radius: 14px; display: grid; place-items: center; overflow: hidden;
    }
    .canvas-wrap > * { max-width: 92%; max-height: 92%; }

    .foot { opacity: 0.8; font-size: 12px; text-align: center; margin-top: 20px; }
    .kbd { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; background: #111827; border: 1px solid rgba(148,163,184,.3); border-bottom-width: 3px; padding: 2px 6px; border-radius: 6px; }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <h1>QR Code Generator</h1>
      </div>
      <div><a href="#" id="permalink">Share this setup ↗</a></div>
    </header>

    <div class="layout">
      <section class="card controls" aria-label="controls">
        <div class="field">
          <label for="text">Text / URL</label>
          <textarea id="text" placeholder="Type or paste the content to encode…">https://github.com/</textarea>
        </div>

        <div class="row">
          <div class="field">
            <label for="size">Size (px)</label>
            <input id="size" type="number" min="64" max="2048" step="16" value="512" />
          </div>
          <div class="field">
            <label for="margin">Margin</label>
            <input id="margin" type="number" min="0" max="20" step="1" value="4" />
          </div>
          <div class="field">
            <label for="ecc">Error Correction</label>
            <select id="ecc">
              <option value="L">L — 7%</option>
              <option value="M" selected>M — 15%</option>
              <option value="Q">Q — 25%</option>
              <option value="H">H — 30%</option>
            </select>
          </div>
          <div class="field">
            <label>&nbsp;</label>
            <div class="actions">
              <button class="primary" id="generate">Generate</button>
            </div>
          </div>
        </div>

        <div class="row">
          <div class="field">
            <label for="dark">Dark Color</label>
            <input id="dark" type="color" value="#000000" />
          </div>
          <div class="field">
            <label for="light">Light Color</label>
            <input id="light" type="color" value="#ffffff" />
          </div>
          <div class="field">
            <label for="format">Format</label>
            <select id="format">
              <option value="svg" selected>SVG</option>
              <option value="png">PNG</option>
            </select>
          </div>
          <div class="field">
            <label>&nbsp;</label>
            <div class="actions">
              <button id="download">Download</button>
            </div>
          </div>
        </div>

        <div class="field inline">
          <label for="quiet" style="grid-column: 1 / -1;">Advanced</label>
          <div class="field">
            <label for="rounding">Module Rounding (SVG)</label>
            <input id="rounding" type="number" min="0" max="40" step="2" value="0" />
          </div>
          <div class="actions">
            <button id="copy-link">Copy Share Link</button>
            <button id="reset">Reset</button>
          </div>
        </div>
      </section>

      <section class="card preview" aria-live="polite">
        <div class="canvas-wrap" id="stage" aria-label="QR code preview"></div>
        <div class="actions">
          <button id="copy-png">Copy as PNG</button>
          <button id="copy-svg">Copy as SVG</button>
        </div>
        <small class="foot">Tip: press <span class="kbd">G</span> to regenerate. Drag the image out to save too.</small>
      </section>
    </div>

    
  </div>

  <!--
    ✅ Library: qrcode-generator (MIT). Hosted via jsDelivr for convenience.
    If you need a fully self-contained single file with zero external requests,
    download qrcode.js (UMD build) and paste the minified source into a <script> tag here.
  -->
  <script src="https://cdn.jsdelivr.net/npm/qrcode-generator@1.4.4/qrcode.js" integrity="sha384-9o9zqQ0bVwYt3aEJkN2z+9v7o7vUoVwqOeQFqvZq5gWfi0QyCEMv1xJ3+9z3m2qA" crossorigin="anonymous"></script>

  <script>
    // --- Utility helpers ---
    const $ = (sel) => document.querySelector(sel);
    const stage = $('#stage');

    const els = {
      text:   $('#text'), size: $('#size'), margin: $('#margin'), ecc: $('#ecc'),
      dark:   $('#dark'), light: $('#light'), format: $('#format'), rounding: $('#rounding')
    };

    const stateFromInputs = () => ({
      text: els.text.value || '',
      size: clamp(int(els.size.value), 64, 2048),
      margin: clamp(int(els.margin.value), 0, 20),
      ecc: els.ecc.value || 'M',
      dark: els.dark.value || '#000000',
      light: els.light.value || '#ffffff',
      format: els.format.value || 'svg',
      rounding: clamp(int(els.rounding.value), 0, 40)
    });

    const int = (v) => Number.parseInt(v, 10) || 0;
    const clamp = (v, a, b) => Math.min(b, Math.max(a, v));

    const ECC = { L: 'L', M: 'M', Q: 'Q', H: 'H' };

    // Convert ECC letter to library constant
    function eccToConst(letter) {
      return { L: QRErrorCorrectLevel.L, M: QRErrorCorrectLevel.M, Q: QRErrorCorrectLevel.Q, H: QRErrorCorrectLevel.H }[letter] || QRErrorCorrectLevel.M;
    }

    // Generate QR matrix with qrcode-generator
    function makeQR(text, ecc) {
      // typeNumber 0 lets the lib pick the minimum version automatically
      const qr = qrcode(0, eccToConst(ecc));
      qr.addData(text);
      qr.make();
      return qr;
    }

    // Render as SVG string (with optional rounded modules)
    function renderSVG(qr, size, margin, dark, light, rounding = 0) {
      const count = qr.getModuleCount();
      const pixels = size; // total viewport size
      const cell = Math.floor((pixels - margin * 2) / count);
      const actual = cell * count + margin * 2; // actual drawn size
      const r = Math.min(rounding, Math.floor(cell / 2));

      const rect = (x, y, w, h) => r > 0
        ? `<rect x="${x}" y="${y}" width="${w}" height="${h}" rx="${r}" ry="${r}" />`
        : `<rect x="${x}" y="${y}" width="${w}" height="${h}" />`;

      let paths = [];
      for (let row = 0; row < count; row++) {
        for (let col = 0; col < count; col++) {
          if (qr.isDark(row, col)) {
            const x = margin + col * cell;
            const y = margin + row * cell;
            paths.push(rect(x, y, cell, cell));
          }
        }
      }

      return `<?xml version="1.0" encoding="UTF-8"?>\n` +
        `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 ${actual} ${actual}" width="${actual}" height="${actual}" shape-rendering="crispEdges" role="img" aria-label="QR Code">` +
        `<rect width="100%" height="100%" fill="${light}"/>` +
        `<g fill="${dark}">` + paths.join('') + `</g></svg>`;
    }

    // Render to a Canvas and return the Canvas element
    function renderCanvas(qr, size, margin, dark, light) {
      const count = qr.getModuleCount();
      const cell = Math.floor((size - margin * 2) / count);
      const actual = cell * count + margin * 2;
      const c = document.createElement('canvas');
      c.width = actual; c.height = actual;
      const ctx = c.getContext('2d');

      // background
      ctx.fillStyle = light;
      ctx.fillRect(0, 0, c.width, c.height);
      ctx.fillStyle = dark;

      for (let row = 0; row < count; row++) {
        for (let col = 0; col < count; col++) {
          if (qr.isDark(row, col)) {
            const x = margin + col * cell;
            const y = margin + row * cell;
            ctx.fillRect(x, y, cell, cell);
          }
        }
      }
      return c;
    }

    function setStage(node) {
      stage.innerHTML = '';
      stage.appendChild(node);
    }

    function render() {
      const s = stateFromInputs();
      if (!s.text) {
        stage.innerHTML = '<em>Enter text to generate a QR code.</em>';
        return;
      }
      const qr = makeQR(s.text, s.ecc);

      if (s.format === 'png') {
        const canvas = renderCanvas(qr, s.size, s.margin, s.dark, s.light);
        canvas.style.imageRendering = 'pixelated';
        setStage(canvas);
        canvas.ariaLabel = 'QR code preview';
      } else {
        const svg = renderSVG(qr, s.size, s.margin, s.dark, s.light, s.rounding);
        const div = document.createElement('div');
        div.innerHTML = svg; // safe; content created by us
        const svgEl = div.firstChild;
        setStage(svgEl);
      }
    }

    function downloadCurrent() {
      const s = stateFromInputs();
      const qr = makeQR(s.text, s.ecc);

      if (s.format === 'png') {
        const canvas = renderCanvas(qr, s.size, s.margin, s.dark, s.light);
        const a = document.createElement('a');
        a.download = `qr-${Date.now()}.png`;
        a.href = canvas.toDataURL('image/png');
        a.click();
      } else {
        const svg = renderSVG(qr, s.size, s.margin, s.dark, s.light, s.rounding);
        const blob = new Blob([svg], { type: 'image/svg+xml' });
        const a = document.createElement('a');
        a.download = `qr-${Date.now()}.svg`;
        a.href = URL.createObjectURL(blob);
        a.click();
        setTimeout(() => URL.revokeObjectURL(a.href), 3000);
      }
    }

    async function copyAs(type) {
      const s = stateFromInputs();
      const qr = makeQR(s.text, s.ecc);
      try {
        if (type === 'svg') {
          const svg = renderSVG(qr, s.size, s.margin, s.dark, s.light, s.rounding);
          await navigator.clipboard.writeText(svg);
        } else {
          const canvas = renderCanvas(qr, s.size, s.margin, s.dark, s.light);
          canvas.toBlob(async (blob) => {
            try {
              await navigator.clipboard.write([
                new ClipboardItem({ 'image/png': blob })
              ]);
            } catch {
              // Fallback: copy data URL as text
              const url = canvas.toDataURL('image/png');
              await navigator.clipboard.writeText(url);
            }
          });
        }
      } catch (e) {
        alert('Copy failed. Your browser may block programmatic clipboard access.');
      }
    }

    function setPermalink() {
      const s = stateFromInputs();
      const params = new URLSearchParams({
        t: s.text, sz: s.size, m: s.margin, e: s.ecc, d: s.dark, l: s.light, f: s.format, r: s.rounding
      });
      const url = location.origin + location.pathname + '?' + params.toString();
      $('#permalink').href = url;
      return url;
    }

    function applyFromURL() {
      const p = new URLSearchParams(location.search);
      const get = (k, def) => p.get(k) ?? def;
      if ([...p.keys()].length === 0) return;
      els.text.value = get('t', els.text.value);
      els.size.value = get('sz', els.size.value);
      els.margin.value = get('m', els.margin.value);
      els.ecc.value = get('e', els.ecc.value);
      els.dark.value = get('d', els.dark.value);
      els.light.value = get('l', els.light.value);
      els.format.value = get('f', els.format.value);
      els.rounding.value = get('r', els.rounding.value);
    }

    // Event hookups
    $('#generate').addEventListener('click', () => { render(); setPermalink(); });
    $('#download').addEventListener('click', downloadCurrent);
    $('#copy-png').addEventListener('click', () => copyAs('png'));
    $('#copy-svg').addEventListener('click', () => copyAs('svg'));
    $('#copy-link').addEventListener('click', async () => {
      const url = setPermalink();
      try { await navigator.clipboard.writeText(url); } catch {}
    });
    $('#reset').addEventListener('click', () => { Object.assign(els, {
      text: { value: '' }, size: { value: 512 }, margin: { value: 4 }, ecc: { value: 'M' },
      dark: { value: '#000000' }, light: { value: '#ffffff' }, format: { value: 'svg' }, rounding: { value: 0 }
    }); render(); setPermalink(); });

    document.addEventListener('keydown', (e) => { if (e.key.toLowerCase() === 'g') { render(); setPermalink(); }});
    ['input', 'change'].forEach(ev => {
      ['#text','#size','#margin','#ecc','#dark','#light','#format','#rounding'].forEach(sel => {
        document.querySelector(sel).addEventListener(ev, () => { render(); setPermalink(); });
      });
    });

    // Init
    applyFromURL();
    render();
    setPermalink();
  </script>
</body>
</html>
