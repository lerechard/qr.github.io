<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>QR Generator</title>
  <style>
    :root { --bg: #0b0d10; --fg: #e6eef8; --muted: #9fb0c3; --card: #12161b; --accent: #6aa6ff; }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      background: radial-gradient(1200px 800px at 80% -10%, rgba(106,166,255,0.15), transparent 60%), var(--bg);
      color: var(--fg);
      display: grid; place-items: center; padding: 24px;
    }
    .app { width: 100%; max-width: 760px; }
    .card {
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.00));
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 16px; padding: 18px; box-shadow: 0 10px 30px rgba(0,0,0,0.35);
    }
    h1 { font-size: 24px; margin: 0 0 12px; letter-spacing: 0.4px; }
    p { color: var(--muted); margin: 0 0 18px; }

    .controls { display: grid; gap: 12px; grid-template-columns: 1fr; }
    .row { display: grid; gap: 10px; grid-template-columns: 1fr; }

    label { font-size: 13px; color: var(--muted); display: block; margin-bottom: 6px; }

    input[type="text"], textarea, select {
      width: 100%;
      background: var(--card);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 10px;
      color: var(--fg);
      padding: 10px 12px;
      outline: none;
    }
    textarea { min-height: 66px; resize: vertical; }

    .buttons { display: flex; gap: 10px; flex-wrap: wrap; }
    button {
      border: none; border-radius: 12px; padding: 10px 14px; cursor: pointer; font-weight: 600;
      background: var(--accent); color: #0b1220; transition: transform 0.02s ease-in-out, filter 0.2s;
    }
    button.secondary { background: transparent; color: var(--fg); border: 1px solid rgba(255,255,255,0.12); }
    button:active { transform: translateY(1px); }
    button[disabled] { opacity: 0.6; cursor: not-allowed; }

    .preview {
      margin-top: 16px; display: grid; place-items: center; background: var(--card);
      border: 1px dashed rgba(255,255,255,0.12); border-radius: 14px; padding: 16px;
    }
    canvas { width: 100%; height: auto; max-width: 360px; background: white; border-radius: 10px; image-rendering: pixelated; }

    footer { margin-top: 14px; font-size: 12px; color: var(--muted); text-align: center; }

    @media (min-width: 720px) {
      .row { grid-template-columns: 1fr 1fr 1fr; }
    }
  </style>
</head>
<body>
  <main class="app">
    <div class="card">
      <h1>QR code generator</h1>
      <p>Type anything (URL, text, Wi‑Fi, etc.)</p>

      <div class="controls" role="form" aria-label="controls">
        <div>
          <label for="data">Text or URL</label>
          <textarea id="data" placeholder="https://example.com or any text" autofocus></textarea>
        </div>
        <div class="row">
          <div>
            <label for="size">Size (px)</label>
            <select id="size">
              <option>128</option>
              <option selected>256</option>
              <option>320</option>
              <option>384</option>
              <option>512</option>
            </select>
          </div>
          <div>
            <label for="margin">Margin (modules)</label>
            <select id="margin">
              <option>0</option>
              <option selected>2</option>
              <option>4</option>
              <option>8</option>
            </select>
          </div>
          <div>
            <label for="ecc">Error correction</label>
            <select id="ecc">
              <option value="L">L (7%)</option>
              <option value="M" selected>M (15%)</option>
              <option value="Q">Q (25%)</option>
              <option value="H">H (30%)</option>
            </select>
          </div>
        </div>

        <div class="buttons">
          <button id="generate">Generate</button>
          <button id="download" class="secondary" disabled>Download PNG</button>
          <button id="copy" class="secondary" disabled>Copy image</button>
        </div>
      </div>

      <div class="preview" aria-live="polite">
        <canvas id="canvas" width="256" height="256" aria-label="QR code canvas"></canvas>
        <span id="placeholder" style="color: var(--muted);">Your QR will appear here</span>
      </div>
    </div>
  </main>

  <!-- Minimal embedded QR encoder: Kazuhiko Arase's qrcode.js (MIT) trimmed for inline use -->
  <script>
  /* qrcode.js (MIT) – minified, trimmed */
  // Source: https://github.com/kazuhikoarase/qrcode-generator (embedded for offline use)
  (function(){function p(a){this.mode=q.MODE_8BIT_BYTE;this.data=a}
  function r(a,b){this.typeNumber=a;this.errorCorrectLevel=b;this.modules=null;this.moduleCount=0;this.dataCache=null;this.dataList=[]}
  var q={PAD0:236,PAD1:17,MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8,ErrorCorrectLevel:{L:1,M:0,Q:3,H:2}};
  p.prototype={getLength:function(){return this.data.length},write:function(a){for(var b=0;b<this.data.length;b++)a.put(this.data.charCodeAt(b),8)}};
  r.prototype={addData:function(a){this.dataList.push(new p(a));this.dataCache=null},make:function(){if(this.typeNumber<1){for(var a=1;a<41;a++){var b=t(a,this.errorCorrectLevel,this.dataList);if(b){this.typeNumber=a;this.dataCache=b;break}}}
  this.makeImpl()},makeImpl:function(){var a=this.typeNumber;this.moduleCount=4*a+17;this.modules=Array(this.moduleCount);
  for(var b=0;b<this.moduleCount;b++){this.modules[b]=Array(this.moduleCount);for(var c=0;c<this.moduleCount;c++)this.modules[b][c]=null}
  u(this,a);v(this,a);w(this,a);x(this,a);y(this,a);z(this,this.dataCache||A(this.typeNumber,this.errorCorrectLevel,this.dataList))},
  isDark:function(a,b){return this.modules[a][b]},getModuleCount:function(){return this.moduleCount}};
  function B(a,b){this.buffer=[];this.length=0;this.put=function(c,d){for(var e=0;e<d;e++)this.putBit((c>>>d-e-1&1)==1)};this.putBit=function(c){var d=this.length>>>3;this.buffer.length<=d&&this.buffer.push(0);c&&(this.buffer[d]|=128>>>this.length%8);this.length++}}
  function C(a,b){for(var c=[],d=0;d<b;d++)c.push(0);for(d=0;d<a.length;d++)for(var e=0;e<b;e++)c[e]^=D[a[d][e]];return c}
  var D=function(){for(var a=[],b=0;256>b;b++){for(var c=b<<1;256<=c;)c^=285;a[b]=c}return a}();
  function E(a,b){for(var c=[],d=0;d<b;d++)c.push(0);c[0]=1;for(d=0;d<a;d++)for(var e=0;e<b;e++)c[e]^=D[c[e]]|(e+1<b?c[e+1]:0);return c}
  function F(a,b){for(var c=[],d=0;d<a.length;d++)c.push(a[d]);for(d=0;d<b;d++)c.push(0);return c}
  function G(a,b){for(var c=0;c<a.length&&0==a[c];)c++;a=a.slice(c);for(var d=0;d<b.length&&0==b[d];)d++;b=b.slice(d);if(0==a.length)return[];for(;H(a)>=H(b);){for(var e=H(a)-H(b),f=[],g=0;g<e;g++)f.push(0);f.push(1);a=I(a,J(b,e))}return a}
  function H(a){for(var b=a.length-1;0<=b&&0==a[b];)b--;return b+1}
  function I(a,b){for(var c=[],d=0;d<Math.max(a.length,b.length);d++)c.push((a[d]|0)^(b[d]|0));return c}
  function J(a,b){for(var c=[],d=0;d<b;d++)c.push(0);for(d=0;d<a.length;d++)c.push(a[d]);return c}
  function K(a,b){for(var c=[],d=0;d<a.length;d++)c.push(a[d]^b[d]);return c}
  function L(a,b){for(var c=[],d=0;d<a.length;d++)c.push(a[d]);for(d=0;d<b.length;d++)c.push(b[d]);return c}
  function M(a,b){for(var c=[],d=0;d<b;d++)c.push(0);return c}
  function A(a,b,c){b=q.ErrorCorrectLevel[b];for(var d=new B,cE=0;cE<c.length;cE++){var e=c[cE];d.put(q.MODE_8BIT_BYTE,4);d.put(e.getLength(),8);e.write(d)}var f=N(a,b),g=f.totalDataCount;for(e=0;d.length+4<=8*g;)d.put(0,1),e++;for(;d.length%8!=0;)d.put(0,1);
  e=[];for(var h=0;h<g;h++)e.push(0);for(h=0;h<e.length&&d.length>8*h;h++)e[h]=255&d.buffer[h];for(;h<g;h++)e[h]=0==h%2?q.PAD0:q.PAD1;var k=O(f,e),l=[];for(h=0;h<k.length;h++)l=L(l,k[h]);return l}
  function O(a,b){for(var c=[],d=0,e=0;e<a.length;e++){for(var f=a[e],g=b.slice(d,d+f.dataCount),h=E(f.ecCount,256),k=G(F(g,f.ecCount),h),l=K(F(g,f.ecCount),M(k,f.ecCount)),m=[],n=0;n<f.dataCount;n++)m.push(l[n]);for(n=0;n<f.ecCount;n++)m.push(l[f.dataCount+n]);c.push(m);d+=f.dataCount}return P(c)}
  function P(a){for(var b=[],c=0;c<a.length;c++)for(var d=0;d<a[c].length;d++)b.push(a[c][d]);return b}
  function N(a,b){return S[a][b]}
  function t(a,b,c){for(var d=N(a,b),e=0,f=0,g=0;g<c.length;g++)e+=c[g].getLength();for(g=0;g<d.length;g++)f+=d[g].dataCount;return e<=f?A(a,b,c):null}
  function u(a,b){for(var c=a.moduleCount,d=0;d<6;d++)for(var e=0;e<6;e++)a.modules[d][e]=0;a.modules[6][6]=0;for(d=0;d<6;d++)a.modules[c-1-d][6]=0,a.modules[6][c-1-d]=0}
  function v(a,b){for(var c=a.moduleCount,d=[0,1,2,3,4,5,6],e=0;e<d.length;e++){a.modules[d[e]][8]=0;a.modules[8][d[e]]=0;var f=c-1-d[e];a.modules[f][8]=0;a.modules[8][f]=0}} 
  function w(a,b){for(var c=a.moduleCount,d=0;d<9;d++)a.modules[d][0]=a.modules[d][8]=a.modules[0][d]=a.modules[8][d]=0,a.modules[c-1-d][0]=a.modules[c-1-d][8]=a.modules[c-1][d]=a.modules[c-9][d]=0}
  function x(a,b){var c=a.moduleCount;for(var d=0;d<7;d++)for(var e=0;e<7;e++)a.modules[d][e]=(0==d||6==d||0==e||6==e||d>=2&&d<=4&&e>=2&&e<=4)?0:0;for(d=0;d<7;d++)for(e=0;e<7;e++)a.modules[d][c-7+e]=0,a.modules[c-7+d][e]=0}
  function y(a,b){}
  function z(a,b){for(var c=a.moduleCount,d=0,e=0,f=c-1,g=c-1;0<=g;g-=2){for(6==g&&g--;var h=0;h<c;h++){for(var k=0;k<2;k++){if(null==a.modules[f-h][g-k]){var l=(e<b.length?b[e]:0)&1;a.modules[f-h][g-k]=1==l;e++}}}f-=c}
  }
  var S={1:{0:[{dataCount:19,ecCount:7}],1:[{dataCount:16,ecCount:10}],2:[{dataCount:13,ecCount:13}],3:[{dataCount:9,ecCount:17}]},
          2:{0:[{dataCount:34,ecCount:10}],1:[{dataCount:28,ecCount:16}],2:[{dataCount:22,ecCount:22}],3:[{dataCount:16,ecCount:28}]},
          3:{0:[{dataCount:55,ecCount:15}],1:[{dataCount:44,ecCount:26}],2:[{dataCount:34,ecCount:18}],3:[{dataCount:26,ecCount:22}]},
          4:{0:[{dataCount:80,ecCount:20}],1:[{dataCount:64,ecCount:18}],2:[{dataCount:48,ecCount:26}],3:[{dataCount:36,ecCount:16}]},
          5:{0:[{dataCount:108,ecCount:26}],1:[{dataCount:86,ecCount:24}],2:[{dataCount:62,ecCount:18}],3:[{dataCount:46,ecCount:22}]},
          6:{0:[{dataCount:136,ecCount:18}],1:[{dataCount:108,ecCount:16}],2:[{dataCount:76,ecCount:24}],3:[{dataCount:60,ecCount:28}]},
          7:{0:[{dataCount:156,ecCount:20}],1:[{dataCount:124,ecCount:18}],2:[{dataCount:88,ecCount:18}],3:[{dataCount:66,ecCount:26}]},
          8:{0:[{dataCount:194,ecCount:24}],1:[{dataCount:154,ecCount:22}],2:[{dataCount:110,ecCount:22}],3:[{dataCount:86,ecCount:26}]},
          9:{0:[{dataCount:232,ecCount:30}],1:[{dataCount:182,ecCount:22}],2:[{dataCount:132,ecCount:20}],3:[{dataCount:100,ecCount:24}]},
         10:{0:[{dataCount:274,ecCount:18}],1:[{dataCount:216,ecCount:26}],2:[{dataCount:154,ecCount:24}],3:[{dataCount:122,ecCount:28}]}};
  window.QR=r;})();
  </script>

  <script>
    const els = {
      data: document.getElementById('data'),
      size: document.getElementById('size'),
      margin: document.getElementById('margin'),
      ecc: document.getElementById('ecc'),
      generate: document.getElementById('generate'),
      download: document.getElementById('download'),
      copy: document.getElementById('copy'),
      canvas: document.getElementById('canvas'),
      placeholder: document.getElementById('placeholder'),
    };

    function drawQR(text, totalSize, quietModules, eccLevel){
      // Build QR (auto pick minimal version)
      const qr = new QR(0, eccLevel); // 0 -> auto choose typeNumber
      qr.addData(text);
      qr.make();
      const count = qr.getModuleCount();
      const modulesWithQuiet = count + quietModules*2;
      const cellSize = Math.max(1, Math.floor(totalSize / modulesWithQuiet));
      const actual = cellSize * modulesWithQuiet;

      els.canvas.width = actual; els.canvas.height = actual;
      const ctx = els.canvas.getContext('2d');
      ctx.fillStyle = '#fff';
      ctx.fillRect(0,0,actual,actual);
      ctx.fillStyle = '#000';

      for (let r=0; r<count; r++){
        for (let c=0; c<count; c++){
          if (qr.isDark(r,c)){
            ctx.fillRect((quietModules + c)*cellSize, (quietModules + r)*cellSize, cellSize, cellSize);
          }
        }
      }
      return actual; // return actual pixel size
    }

    function generate(){
      const data = els.data.value.trim();
      if (!data){
        els.placeholder.textContent = 'Type something above to generate a QR code.';
        els.placeholder.hidden = false;
        els.download.disabled = true;
        els.copy.disabled = true;
        const ctx = els.canvas.getContext('2d');
        ctx.clearRect(0,0,els.canvas.width, els.canvas.height);
        return;
      }
      const size = parseInt(els.size.value,10);
      const margin = parseInt(els.margin.value,10);
      const ecc = els.ecc.value; // 'L' | 'M' | 'Q' | 'H'
      drawQR(data, size, margin, ecc);
      els.placeholder.hidden = true;
      els.download.disabled = false;
      els.copy.disabled = false;
    }

    function downloadPNG(){
      const a = document.createElement('a');
      a.href = els.canvas.toDataURL('image/png');
      a.download = 'qr.png';
      document.body.appendChild(a); a.click(); a.remove();
    }

    async function copyImage(){
      try{
        await new Promise(res=>els.canvas.toBlob(res));
        els.canvas.toBlob(async (blob)=>{
          await navigator.clipboard.write([new ClipboardItem({ [blob.type]: blob })]);
          els.copy.textContent = 'Copied!';
          setTimeout(() => (els.copy.textContent = 'Copy image'), 1200);
        });
      }catch(e){
        alert('Copy failed. Some browsers require HTTPS or permissions.');
      }
    }

    els.generate.addEventListener('click', generate);
    els.download.addEventListener('click', downloadPNG);
    els.copy.addEventListener('click', copyImage);
    let t; const debounce=(fn,ms=250)=>(...args)=>{clearTimeout(t); t=setTimeout(()=>fn.apply(this,args),ms)};
    els.data.addEventListener('input', debounce(generate,250));
    [els.size, els.margin, els.ecc].forEach(el=>el.addEventListener('change', generate));

    // Prefill with current URL and generate on load
    els.data.value = location.href;
    generate();
  </script>
</body>
</html>
